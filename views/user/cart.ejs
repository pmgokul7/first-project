<%-include("../partials/top.ejs")%>
  <style>
    @import "compass/css3";

    /* I wanted to go with a mobile first approach, but it actually lead to more verbose CSS in this case, so I've gone web first. Can't always force things... Side note: I know that this style of nesting in SASS doesn't result in the most performance efficient CSS code... but on the OCD/organizational side, I like it. So for CodePen purposes, CSS selector performance be damned. */
    /* Global settings */
    /* Global "table" column settings */
    .product-image {
      float: left;
      width: 20%;
    }

    .product-details {
      float: left;
      width: 37%;
    }

    .product-price {
      float: left;
      width: 12%;
    }

    .product-quantity {
      float: left;
      width: 10%;
    }

    .product-removal {
      float: left;
      width: 9%;
    }

    .product-line-price {
      float: left;
      width: 12%;
      text-align: right;
    }

    /* This is used as the traditional .clearfix class */
    .group:before,
    .shopping-cart:before,
    .column-labels:before,
    .product:before,
    .totals-item:before,
    .group:after,
    .shopping-cart:after,
    .column-labels:after,
    .product:after,
    .totals-item:after {
      content: "";
      display: table;
    }

    .group:after,
    .shopping-cart:after,
    .column-labels:after,
    .product:after,
    .totals-item:after {
      clear: both;
    }

    .group,
    .shopping-cart,
    .column-labels,
    .product,
    .totals-item {
      zoom: 1;
    }

    /* Apply clearfix in a few places */
    /* Apply dollar signs */
    .product .product-price:before,
    .product .product-line-price:before,
    .totals-value:before {
      content: "â‚¹";
    }

    /* Body/Header stuff */
    body {

      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-weight: 100;
    }

    h1 {
      font-weight: 400;
    }

    label {
      color: #aaa;
    }

    .shopping-cart {
      margin-top: -45px;
    }

    /* Column headers */
    .column-labels label {
      padding-bottom: 15px;
      margin-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .column-labels .product-image,
    .column-labels .product-details,
    .column-labels .product-removal {
      text-indent: -9999px;
    }

    /* Product entries */
    .product {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .product .product-image {
      text-align: center;
    }

    .product .product-image img {
      width: 100px;
    }

    .product .product-details .product-title {
      margin-right: 20px;
      font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
    }

    .product .product-details .product-description {
      margin: 5px 20px 5px 0;
      line-height: 1.4em;
    }

    .product .product-quantity input {
      width: 40px;
    }

    .product .remove-product {
      border: 0;
      padding: 4px 8px;
      background-color: #c66;
      color: #fff;
      font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
      font-size: 12px;
      border-radius: 3px;
    }

    .product .remove-product:hover {
      background-color: #a44;
    }

    /* Totals section */
    .totals .totals-item {
      float: right;
      clear: both;
      width: 100%;
      margin-bottom: 10px;
    }

    .totals .totals-item label {
      float: left;
      clear: both;
      width: 79%;
      text-align: right;
    }

    .totals .totals-item .totals-value {
      float: right;
      width: 21%;
      text-align: right;
    }

    .totals .totals-item-total {
      font-family: "HelveticaNeue-Medium", "Helvetica Neue Medium";
    }

    .checkout {
      float: right;
      border: 0;
      margin-top: 20px;
      padding: 6px 25px;
      background-color: #6b6;
      color: #fff;
      font-size: 25px;
      border-radius: 3px;
    }

    .checkout:hover {
      background-color: #494;
    }

    /* Make adjustments for tablet */
    @media screen and (max-width: 650px) {
      .shopping-cart {
        margin: 0;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .column-labels {
        display: none;
      }

      .product-image {
        float: right;
        width: auto;
      }

      .product-image img {
        margin: 0 0 10px 10px;
      }

      .product-details {
        float: none;
        margin-bottom: 10px;
        width: auto;
      }

      .product-price {
        clear: both;
        width: 70px;
      }

      .product-quantity {
        width: 100px;
      }

      .product-quantity input {
        margin-left: 20px;
      }

      .product-quantity:before {
        content: "x";
      }

      .product-removal {
        width: auto;
      }

      .product-line-price {
        float: right;
        width: 70px;
      }
    }

    /* Make more adjustments for phone */
    @media screen and (max-width: 350px) {
      .product-removal {
        float: right;
      }

      .product-line-price {
        float: right;
        clear: left;
        width: auto;
        margin-top: 10px;
      }

      .product .product-line-price:before {
        content: "Item Total: $";
      }

      .totals .totals-item label {
        width: 60%;
      }

      .totals .totals-item .totals-value {
        width: 40%;
      }
    }
  </style>

  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <a href="/home" style="text-decoration: none;color: #fff;"><span class="mdl-layout-title">Home</span></a>
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation. We hide it in small screens. -->
          <nav class="mdl-navigation mdl-layout--large-screen-only">
            <button id="demo-menu-lower-right" class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">more_vert</i>
            </button>

            <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="demo-menu-lower-right">
              <a href="/home/cart">
                <li class="mdl-menu__item">Cart</li>
              </a>
              <li class="mdl-menu__item">Another Action</li>
              <li disabled class="mdl-menu__item">Disabled Action</li>
              <a href="/logout">
                <li class="mdl-menu__item">log out</li>
              </a>
            </ul>


          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Title</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link" href="/admin">Dashboard</a>
          <a class="mdl-navigation__link" href="/admin/products">Products</a>
          <a class="mdl-navigation__link" href="/admin/users">Users</a>
          <a class="mdl-navigation__link" href="/admin/category">Category</a>
        </nav>
      </div>
      <main class="mdl-layout__content">
        <div class="page-content">
          <!-- Your content goes here -->
          <div class=" mt-4 container-fluid">



            <div class="toast " id="maintoast" role="alert" aria-live="assertive" aria-atomic="true" style="position: absolute;bottom:7%;right:2% ;">
              <div class="toast-header">
                <img src="..." class="rounded me-2" alt="...">
                <strong class="me-auto">Bootstrap</strong>
                <small>11 mins ago</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
              <div class="toast-body">
                Hello, world! This is a toast message.
              </div>
            </div>




            
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>





            <div class="shopping-cart mt-4 container-fluid">

              <div class="column-labels">
                <label class="product-image">Image</label>
                <label class="product-details">Product</label>
                <label class="product-price">Price</label>
                <label class="product-quantity">Quantity</label>
                <label class="product-line-price" style="text-align:left ;">Total</label>
                <label class="product-removal">Remove</label>

              </div>
              <%for (i=0;i<= result.length-1;i++){%>
                <div class="product  ">
                  <div class="product-image">
                    <img src="<%=result[i].p[0].mainImage%>">
                  </div>
                  <div class="product-details">
                    <div class="product-title " style="font-size:20px ;">
                      <%=result[i].p[0].model%>
                    </div>
                    <p class="product-description">
                      <%=result[i].p[0].description%>
                    </p>
                  </div>
                  <div class="product-price ">
                    <%=result[i].p[0].price%>
                  </div>
                  
                  <div class="product-quantity">
                    <input type="number" value="1" min="1" onchange="quantityup('<%=result[i].p[0]._id%>')">
                  </div>















                  <div class="product-line-price" style="text-align: left;">
                    <%=result[i].p[0].price%>
                  </div>

                  <div class="product-removal">
                    
                      <button class="remove-product button-default link" id="removebtn" onclick="btnclick('<%=result[i].p[0]._id%>')">
                        Remove
                      </button>
                    </a>
                  </div>



                </div>
                <%}%>



                  <div class="totals">
                    <div class="totals-item">
                      <label>Subtotal</label>
                      <div class="totals-value" id="cart-subtotal">71.97</div>
                    </div>
                    <div class="totals-item">
                      <label>Tax (5%)</label>
                      <div class="totals-value" id="cart-tax">3.60</div>
                    </div>
                    <div class="totals-item">
                      <label>Shipping</label>
                      <div class="totals-value" id="cart-shipping">15.00</div>
                    </div>
                    <div class="totals-item totals-item-total">
                      <label>Grand Total</label>
                      <div class="totals-value" id="cart-total">90.57</div>
                    </div>
                  </div>
<a href="/home/cart/checkout">
   <button onclick="checkout()"  class="checkout">Checkout</button>
</a>
                 

            </div>



          </div>

        </div>
      </main>
      <script>
// function checkout() {
//   $.post("/home/cart/checkout",{
   
//   subTotal:$("#cart-subtotal").text(),
//   tax:$("#cart-tax").text(),
//   shipping:$("#cart-shipping").text(),
//   grandTotal:$("#cart-total").text()
//   },(data)=>{
//     // location.href="/home/cart/checkout"
//     console.log(data);  
//     location.reload()
//     })
// }

        /* Set rates + misc */
        // var taxRate = 0.05;
        // var shippingRate = 15.00;
        // var fadeTime = 100;
        // $('.toast').toast({ delay: 3000, });
        // $('.toast').toast('show');
        // // $('.remove-product').click(()=>{
        // //    $('.toast').show()
        // // })
        // /* Assign actions */
        // $('.product-quantity input').change(function () {
        //   updateQuantity(this);
        // });

        // $('.product-removal button').click(function () {
        //   removeItem(this);
        // });


        // /* Recalculate cart */
        // function recalculateCart() {
        //   var subtotal = 0;

        //   /* Sum up row totals */
        //   $('.product').each(function () {
        //     subtotal += parseFloat($(this).children('.product-line-price').text());
        //   });

        //   /* Calculate totals */
        //   var tax = subtotal * taxRate;
        //   var shipping = (subtotal > 0 ? shippingRate : 0);
        //   var total = subtotal + tax + shipping;

        //   /* Update totals display */
        //   $('.totals-value').fadeOut(fadeTime, function () {
        //     $('#cart-subtotal').html(subtotal.toFixed(2));
        //     $('#cart-tax').html(tax.toFixed(2));
        //     $('#cart-shipping').html(shipping.toFixed(2));
        //     $('#cart-total').html(total.toFixed(2));
        //     if (total == 0) {
        //       $('.checkout').fadeOut(fadeTime);
        //     } else {
        //       $('.checkout').fadeIn(fadeTime);
        //     }
        //     $('.totals-value').fadeIn(fadeTime);
        //   });
        // }


        // /* Update quantity */
        // function updateQuantity(quantityInput) {
        //   /* Calculate line price */
        //   var productRow = $(quantityInput).parent().parent();
        //   var price = parseFloat(productRow.children('.product-price').text());
        //   var quantity = $(quantityInput).val();
        //   var linePrice = price * quantity;

        //   /* Update line price display and recalc cart totals */
        //   productRow.children('.product-line-price').each(function () {
        //     $(this).fadeOut(fadeTime, function () {
        //       $(this).text(linePrice.toFixed(2));
        //       recalculateCart();
        //       $(this).fadeIn(fadeTime);
        //     });
        //   });
        // }
        

        // /* Remove item from cart */
        // function removeItem(removeButton) {
          
        //   /* Remove row from DOM and recalc cart total */
        //   var productRow = $(removeButton).parent().parent();
        //   productRow.slideUp(fadeTime, function () {
        //     productRow.remove();
        //     recalculateCart();
        //   });
        // }
        //  let toast=$("#maintoast")
        
        //  toast.css("display","none")
         
         $("#removebtn").click(btnclick=(x)=>{
          // toast.css("display","block")
            
          $.post(`/home/cart/remove?id=${x}`,
          function (params) {
            alert("done");
          }
          )
        
         })


function quantityup(id) {
  $.post("/home/quantitychange",
  {
    id:id
  },()=>{
    
  })
}        
        var taxRate = 0.05;
var shippingRate = 15.00; 
var fadeTime = 300;


/* Assign actions */
$('.product-quantity input').change( function() {
  updateQuantity(this);
});

$('.product-removal button').click( function() {
  removeItem(this);
});


/* Recalculate cart */
function recalculateCart()
{
  var subtotal = 0;
  
  /* Sum up row totals */
  $('.product').each(function () {
    subtotal += parseFloat($(this).children('.product-line-price').text());
  });
  
  /* Calculate totals */
  var tax = subtotal * taxRate;
  var shipping = (subtotal > 0 ? shippingRate : 0);
  var total = subtotal + tax + shipping;
  
  /* Update totals display */
  $('.totals-value').fadeOut(fadeTime, function() {
    $('#cart-subtotal').html(subtotal.toFixed(2));
    $('#cart-tax').html(tax.toFixed(2));
    $('#cart-shipping').html(shipping.toFixed(2));
    $('#cart-total').html(total.toFixed(2));
    if(total == 0){
      $('.checkout').fadeOut(fadeTime);
    }else{
      $('.checkout').fadeIn(fadeTime);
    }
    $('.totals-value').fadeIn(fadeTime);
  });
}


/* Update quantity */
function updateQuantity(quantityInput)
{
  /* Calculate line price */
  var productRow = $(quantityInput).parent().parent();
  var price = parseFloat(productRow.children('.product-price').text());
  var quantity = $(quantityInput).val();
  var linePrice = price * quantity;
  
  /* Update line price display and recalc cart totals */
  productRow.children('.product-line-price').each(function () {
    $(this).fadeOut(fadeTime, function() {
      $(this).text(linePrice.toFixed(2));
      recalculateCart();
      $(this).fadeIn(fadeTime);
    });
  });  
}


/* Remove item from cart */
function removeItem(removeButton)
{
  /* Remove row from DOM and recalc cart total */
  var productRow = $(removeButton).parent().parent();
  productRow.slideUp(fadeTime, function() {
    productRow.remove();
    recalculateCart();
  });
}
      </script>
  </body>
